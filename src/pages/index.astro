---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import PostCard from "../components/PostCard.astro";
import { getCollection } from "astro:content";

const published = (p: any) => !p.data?.draft;

const research = (await getCollection("research", published))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const insights = (await getCollection("insights", published))
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const featuredResearch  = research.slice(0, 3);
const featuredInsights  = insights.slice(0, 2);
const totalDocs = research.length + insights.length;

const insightTypeLabel: Record<string, string> = {
  interview: "인터뷰",
  analysis:  "제도 해석",
  outlook:   "전망",
  note:      "노트",
};
---
<BaseLayout
  title="간병연구소"
  description="현장 데이터와 제도 분석을 결합해, 간병비·인력·운영 판단에 바로 쓸 수 있는 근거를 만듭니다."
>
  <Header />
  <main>

    <!-- ══════ HERO ══════ -->
    <section class="hero">
      <div class="hero-accent" aria-hidden="true"></div>
      <div class="container">
        <div class="hero-inner">
          <div class="hero-content">
            <div class="eyebrow">CaregiverLab · Research & Insights</div>
            <h1 class="hero-h1">
              간병 데이터와 제도 해석을<br />
              <em>실무가 바로 쓰는 문서</em>로 만듭니다.
            </h1>
            <p class="hero-sub">
              현장 데이터와 제도 분석을 결합해, 간병비·인력·운영 판단에
              바로 쓸 수 있는 근거를 만듭니다.
              모든 문서에 출처와 집계 방법을 명시합니다.
            </p>
            <div class="hero-cta">
              <a href="/research/" class="btn btn-primary">리서치 보기 →</a>
              <a href="/insights/" class="btn btn-ghost">Insights</a>
              <a href="/about/" class="btn btn-ghost">About</a>
            </div>
          </div>

          <div class="hero-stats">
            <div class="stat-item">
              <div class="stat-num">{totalDocs}</div>
              <div class="stat-label">Publications</div>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
              <div class="stat-num">2018</div>
              <div class="stat-label">Established</div>
            </div>
            <div class="stat-divider"></div>
            <div class="stat-item">
              <div class="stat-num">Monthly</div>
              <div class="stat-label">Update Cycle</div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- ══════ OUTPUTS ══════ -->
    <section class="outputs-section">
      <div class="container">
        <div class="card-strip cols-3">
          <div class="cell">
            <div class="out-num">01</div>
            <div class="out-title">Research Brief</div>
            <div class="out-body">현장 데이터·공공 통계 기반의 분석. 출처와 집계 방법 명시</div>
          </div>
          <div class="cell">
            <div class="out-num">02</div>
            <div class="out-title">Expert Interview</div>
            <div class="out-body">변호사·의사·세무사 등 각계 전문가와의 현장 대담</div>
          </div>
          <div class="cell" style="border-right:none;">
            <div class="out-num">03</div>
            <div class="out-title">Policy Analysis</div>
            <div class="out-body">간병 관련 제도의 독자적 해석과 향후 방향 전망</div>
          </div>
        </div>
      </div>
    </section>

    <!-- ══════ RESEARCH AREAS ══════ -->
    <section class="areas-section">
      <div class="container">
        <div class="sec-head">
          <h2>연구 분야</h2>
          <span class="label">Research Areas</span>
        </div>
        <div class="areas-grid">
          {[
            { ko: "간병비 현황",  en: "Cost & Rate",      icon: "₩", desc: "간병인 일당·월급 시세, 병원별·지역별 간병비 실태 집계" },
            { ko: "간병인 인력",  en: "Workforce",        icon: "人", desc: "간병인 수급 현황, 채용 경로, 계약 조건 분석" },
            { ko: "법적 보호",    en: "Legal",            icon: "法", desc: "성년후견, 노인복지법, 의료동의 관련 법제도" },
            { ko: "시설·운영",    en: "Facility & Ops",   icon: "建", desc: "병원·요양원 간병 운영 기준, 간병인 배치 실태" },
            { ko: "정책·제도",    en: "Policy",           icon: "政", desc: "간병 관련 정책 동향, 제도 변경 사항 분석" },
            { ko: "데이터·통계",  en: "Data & Stats",     icon: "統", desc: "공공 통계 가공·해석, 간병 현장 실태조사 요약" },
          ].map(a => (
            <div class="area-card">
              <div class="area-icon" aria-hidden="true">{a.icon}</div>
              <div class="area-ko">{a.ko}</div>
              <div class="area-en">{a.en}</div>
              <div class="area-desc">{a.desc}</div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- ══════ LATEST RESEARCH ══════ -->
    <section class="content-section">
      <div class="container">
        <div class="sec-head">
          <h2>최신 리서치</h2>
          <a href="/research/" class="see-all">전체 보기 →</a>
        </div>
        {featuredResearch.length > 0 ? (
          <div class:list={["card-strip",
            featuredResearch.length === 1 ? "cols-1" :
            featuredResearch.length === 2 ? "cols-2" : "cols-3"
          ]}>
            {featuredResearch.map(p => <PostCard post={p} />)}
          </div>
        ) : (
          <div class="empty-state">첫 번째 리서치 브리프가 곧 공개됩니다.</div>
        )}
      </div>
    </section>

    <!-- ══════ LATEST INSIGHTS ══════ -->
    <section class="content-section">
      <div class="container">
        <div class="sec-head">
          <h2>최신 Insights</h2>
          <a href="/insights/" class="see-all">전체 보기 →</a>
        </div>
        {featuredInsights.length > 0 ? (
          <div class:list={["card-strip",
            featuredInsights.length === 1 ? "cols-1" : "cols-2"
          ]}>
            {featuredInsights.map(p => (
              <PostCard
                post={p}
                label={
                  p.data.interviewee
                    ? `인터뷰 · ${p.data.interviewee}`
                    : `Insights · ${insightTypeLabel[p.data.type] ?? p.data.type}`
                }
              />
            ))}
          </div>
        ) : (
          <div class="empty-state">전문가 인터뷰와 제도 해석이 곧 공개됩니다.</div>
        )}
      </div>
    </section>

    <!-- ══════ ARCHIVE BAND ══════ -->
    <section class="archive-section">
      <div class="container">
        <div class="archive-band">
          <div class="archive-left">
            <div class="archive-label">Archive</div>
            <div class="archive-title">2018년부터 쌓아온 현장 기록</div>
            <p class="archive-body">
              간병연구소의 초기 아카이브는 서울간병인협회 블로그에 보존되어 있습니다.
              간병일지, 의사소통 가이드, 호스피스 케어 등 현장 기록을 확인할 수 있습니다.
            </p>
          </div>
          <a
            href="https://www.seoulhr.com/blog"
            target="_blank"
            rel="noopener noreferrer"
            class="archive-link"
          >
            아카이브 보기 <span class="archive-arrow">↗</span>
          </a>
        </div>
      </div>
    </section>

    <!-- ══════ CTA ══════ -->
    <section class="cta-section">
      <div class="container">
        <div class="cta-band">
          <div class="cta-watermark" aria-hidden="true">研</div>
          <div class="cta-left">
            <div class="eyebrow" style="color: var(--gold); margin-bottom: 12px;">
              자료 요청 · 협업 · 제휴
            </div>
            <h2 class="cta-h2">간병 관련 자료가 필요하신가요?</h2>
            <p class="cta-body">
              기사 자문, 기업 컨설팅, 정책 브리핑, 학술 공동연구 등<br />
              목적에 맞춰 브리프 형태로 정리해 드립니다.
            </p>
            <div class="cta-btns">
              <a href="/contact/" class="btn btn-inv">문의하기 →</a>
              <a href="/about/" class="btn btn-ghost-inv">About 보기</a>
            </div>
          </div>
          <div class="cta-right">
            {[
              { label: "B2B",    desc: "기업·기관 간병 제도 컨설팅, 직원 교육 자료" },
              { label: "산학협력", desc: "연구자·대학원생 공동연구, 데이터 협의" },
              { label: "B2G",    desc: "정책 입안 지원, 의회·행정기관 브리핑" },
            ].map(c => (
              <div class="cta-type">
                <span class="cta-type-label">{c.label}</span>
                <span class="cta-type-desc">{c.desc}</span>
              </div>
            ))}
          </div>
        </div>
      </div>
    </section>

  </main>
  <Footer />
</BaseLayout>

<style>
/* ── Hero ── */
.hero {
  padding: 72px 0 60px;
  border-bottom: 1px solid var(--bd);
  position: relative;
  overflow: hidden;
}
.hero-accent {
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--accent), var(--gold) 55%, transparent);
}
.hero-inner {
  display: grid;
  grid-template-columns: 1fr 200px;
  gap: 48px;
  align-items: start;
}
.hero-h1 {
  font-family: var(--serif);
  font-weight: 600;
  font-size: clamp(26px, 4vw, 38px);
  line-height: 1.5;
  letter-spacing: -0.015em;
  color: var(--ink);
  margin: 14px 0 16px;
}
.hero-h1 em { font-style: italic; color: var(--accent); }
.hero-sub {
  font-size: 15px;
  font-weight: 300;
  line-height: 1.75;
  color: var(--muted);
  max-width: 460px;
  margin-bottom: 28px;
}
.hero-cta { display: flex; gap: 8px; flex-wrap: wrap; }
.hero-stats {
  display: flex;
  flex-direction: column;
  border: 1px solid var(--bd);
  border-radius: var(--r);
  overflow: hidden;
  align-self: start;
  margin-top: 4px;
}
.stat-item { padding: 18px 20px; text-align: center; }
.stat-num {
  font-family: var(--roman);
  font-size: 22px;
  font-weight: 500;
  color: var(--ink);
  line-height: 1.2;
}
.stat-label {
  font-family: var(--roman);
  font-size: 10px;
  letter-spacing: 0.14em;
  text-transform: uppercase;
  color: var(--subtle);
  margin-top: 5px;
}
.stat-divider { border-top: 1px solid var(--bd); }

/* ── Outputs ── */
.outputs-section { padding: 28px 0; border-bottom: 1px solid var(--bd); }
.out-num {
  font-family: var(--roman);
  font-size: 12px;
  letter-spacing: 0.1em;
  color: var(--gold);
  margin-bottom: 8px;
}
.out-title {
  font-family: var(--serif);
  font-weight: 600;
  font-size: 14px;
  color: var(--ink);
  margin-bottom: 6px;
}
.out-body {
  font-size: 13px;
  font-weight: 300;
  line-height: 1.65;
  color: var(--muted);
}

/* ── Areas ── */
.areas-section { padding: 8px 0 0; border-bottom: 1px solid var(--bd); }
.areas-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  border: 1px solid var(--bd);
  border-radius: var(--r);
  overflow: hidden;
  margin-bottom: 40px;
}
.area-card {
  padding: 22px 20px 20px;
  border-right: 1px solid var(--bd);
  border-bottom: 1px solid var(--bd);
  transition: background 0.14s;
}
.area-card:hover { background: var(--cream); }
.area-card:nth-child(3n) { border-right: none; }
.area-card:nth-last-child(-n+3) { border-bottom: none; }
.area-icon { font-family: var(--serif); font-size: 22px; color: var(--accent); opacity: 0.6; margin-bottom: 10px; }
.area-ko   { font-family: var(--serif); font-weight: 600; font-size: 15px; color: var(--ink); margin-bottom: 2px; }
.area-en   { font-family: var(--roman); font-size: 11px; letter-spacing: 0.12em; text-transform: uppercase; color: var(--subtle); margin-bottom: 8px; }
.area-desc { font-size: 12px; font-weight: 300; line-height: 1.6; color: var(--muted); }

/* ── Content sections ── */
.content-section { padding: 0 0 8px; border-bottom: 1px solid var(--bd); }
.empty-state {
  border: 1px dashed var(--bd);
  border-radius: var(--r);
  padding: 28px 22px;
  font-size: 13px;
  font-weight: 300;
  color: var(--muted);
}

/* ── Archive ── */
.archive-section { padding: 32px 0; border-bottom: 1px solid var(--bd); }
.archive-band {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 32px;
  padding: 28px 32px;
  background: var(--cream);
  border: 1px solid var(--bd);
  border-radius: var(--r);
  border-left: 3px solid var(--gold);
}
.archive-label { font-family: var(--roman); font-size: 10px; letter-spacing: 0.18em; text-transform: uppercase; color: var(--gold); margin-bottom: 6px; }
.archive-title { font-family: var(--serif); font-weight: 600; font-size: 16px; color: var(--ink); margin-bottom: 8px; }
.archive-body  { font-size: 13px; font-weight: 300; line-height: 1.7; color: var(--muted); max-width: 480px; }
.archive-link {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  font-family: var(--sans);
  font-size: 13px;
  font-weight: 500;
  color: var(--accent);
  border: 1px solid var(--bd);
  padding: 9px 18px;
  border-radius: var(--r);
  white-space: nowrap;
  flex-shrink: 0;
  text-decoration: none;
  transition: background 0.14s, border-color 0.14s;
}
.archive-link:hover { background: var(--cream-2); border-color: var(--accent); }
.archive-arrow { font-family: var(--roman); font-size: 16px; display: inline-block; transition: transform 0.13s; }
.archive-link:hover .archive-arrow { transform: translate(2px, -2px); }

/* ── CTA ── */
.cta-section { padding: 40px 0 48px; }
.cta-band {
  background: var(--ink);
  border-radius: var(--r);
  padding: 44px 40px;
  display: grid;
  grid-template-columns: 1fr auto;
  gap: 48px;
  align-items: center;
  position: relative;
  overflow: hidden;
}
.cta-watermark {
  position: absolute;
  right: 32px; top: -20px;
  font-family: var(--serif);
  font-size: 140px;
  font-weight: 700;
  color: rgba(255,255,255,0.035);
  line-height: 1;
  pointer-events: none;
  user-select: none;
}
.cta-h2   { font-family: var(--serif); font-weight: 600; font-size: 22px; color: #fff; margin-bottom: 10px; letter-spacing: -0.01em; }
.cta-body { font-size: 14px; font-weight: 300; line-height: 1.75; color: rgba(255,255,255,0.55); margin-bottom: 24px; }
.cta-btns { display: flex; gap: 10px; flex-wrap: wrap; }
.cta-right { display: flex; flex-direction: column; gap: 12px; min-width: 220px; }
.cta-type { display: flex; flex-direction: column; gap: 4px; padding: 14px 16px; border: 1px solid rgba(255,255,255,0.1); border-radius: var(--r); }
.cta-type-label { font-family: var(--roman); font-size: 11px; letter-spacing: 0.14em; text-transform: uppercase; color: var(--gold); }
.cta-type-desc  { font-size: 12px; font-weight: 300; color: rgba(255,255,255,0.5); line-height: 1.55; }

/* ── Responsive ── */
@media (max-width: 760px) {
  .hero-inner { grid-template-columns: 1fr; gap: 32px; }
  .hero-stats { flex-direction: row; }
  .stat-item  { flex: 1; }
  .stat-divider { width: 1px; height: auto; border-top: none; border-left: 1px solid var(--bd); }
  .cta-band { grid-template-columns: 1fr; gap: 28px; padding: 32px 24px; }
  .cta-right { flex-direction: row; flex-wrap: wrap; }
  .cta-type  { flex: 1; min-width: 140px; }
  .archive-band { flex-direction: column; align-items: flex-start; gap: 20px; }
}
@media (max-width: 560px) {
  .areas-grid { grid-template-columns: 1fr 1fr; }
  .area-card:nth-child(3n) { border-right: 1px solid var(--bd); }
  .area-card:nth-child(2n) { border-right: none; }
  .area-card:nth-last-child(-n+2) { border-bottom: none; }
  .area-card:nth-last-child(-n+3) { border-bottom: 1px solid var(--bd); }
}
</style>
